apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: app-ingress
  annotations:
    nginx.ingress.kubernetes.io/enable-modsecurity: 'true'
    nginx.ingress.kubernetes.io/modsecurity-snippet: |
      SecRuleEngine On
      SecRequestBodyAccess On
      SecAuditEngine RelevantOnly
      SecAuditLogParts ABIJDEFHZ
      SecAuditLog /var/log/modsec_audit.log
      SecRule REQUEST_HEADERS:User-Agent 'bad-scanner' 'log,deny,status:403,msg:\'Scanner Detected\''
spec:
  rules:
  - http:
      paths:
      - path: /juiceshop
        pathType: Prefix
        backend:
          service:
            name: juiceshop
            port:
              number: 80
      - path: /phpinfo
        pathType: Prefix
        backend:
          service:
            name: php-info
            port:
              number: 80
      - path: /echoserver
        pathType: Prefix
        backend:
          service:
            name: echo-server
            port:
              number: 8081
